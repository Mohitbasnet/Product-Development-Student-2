{% extends 'base.html' %}
{% block title %}Gallery - AI-Solutions{% endblock %}

{% load static %}
{% block content %}
{% block extra_css %}<link rel="stylesheet" href="{% static 'css/gallery.css' %}">{% endblock %}
<div class="container mt-4 gallery-hero on-dark">
    <div class="panel-glass p-4 p-md-5 mb-3">
        <h1 class="mb-2">Gallery</h1>
        <p class="text-muted mb-0">A curated selection of images from our solutions, articles, events, and clients.</p>
    </div>

    {% if gallery_images %}
    <div class="row g-3 gallery-grid">
        {% for gi in gallery_images %}
        <div class="col-6 col-md-4 col-lg-3">
            <div class="card border-0 shadow-sm gallery-card">
                {% if gi.image %}
                <a href="{{ gi.image.url }}" class="gallery-item" data-index="{{ forloop.counter0 }}" data-label="{{ gi.label }}" role="button" aria-label="Open image {{ gi.label }} in full view">
                    <div class="media-box">
                        <img src="{{ gi.image.url }}" alt="{{ gi.label }}" loading="lazy" decoding="async" sizes="(min-width:1200px) 22vw, (min-width:992px) 30vw, (min-width:576px) 45vw, 50vw">
                        <div class="zoom-icon"><i class="fas fa-search"></i></div>
                    </div>
                </a>
                {% else %}
                <div class="media-box placeholder d-flex align-items-center justify-content-center">
                    <span class="small text-muted">Image pending</span>
                </div>
                {% endif %}
                <div class="card-body p-2">
                    <div class="small text-muted text-truncate">{{ gi.label }}</div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info">No images to display yet.</div>
    {% endif %}
</div>
{% endblock %}


{% block extra_js %}
<script>
  (function(){
    const items = Array.from(document.querySelectorAll('.gallery-item'));
    if (!items.length) return;
    const sources = items.map(a => ({ src: a.getAttribute('href'), label: a.dataset.label }));
    let current = 0;

    const modalEl = document.createElement('div');
    modalEl.className = 'modal fade';
    modalEl.id = 'lightboxModal';
    modalEl.tabIndex = -1;
    modalEl.innerHTML = `
      <div class="modal-dialog modal-fullscreen">
        <div class="modal-content bg-dark">
          <div class="modal-header border-0">
            <h5 class="modal-title text-white" id="lightboxLabel"></h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body d-flex align-items-center justify-content-center p-0">
            <img id="lightboxImage" class="img-fluid" alt="Preview" />
          </div>
          <div class="modal-footer border-0 justify-content-between">
            <button type="button" class="btn btn-outline-light" id="lbPrev"><i class="fas fa-chevron-left me-1"></i>Prev</button>
            <button type="button" class="btn btn-outline-light" id="lbNext">Next<i class="fas fa-chevron-right ms-1"></i></button>
          </div>
        </div>
      </div>`;
    document.body.appendChild(modalEl);

    const bsModal = new bootstrap.Modal(modalEl);
    const imgEl = modalEl.querySelector('#lightboxImage');
    const labelEl = modalEl.querySelector('#lightboxLabel');
    const prevBtn = modalEl.querySelector('#lbPrev');
    const nextBtn = modalEl.querySelector('#lbNext');

    function show(index){
      current = (index + sources.length) % sources.length;
      const { src, label } = sources[current];
      imgEl.src = src; imgEl.alt = label; labelEl.textContent = label;
      bsModal.show();
    }

    items.forEach((a, idx) => {
      a.addEventListener('click', (e) => { e.preventDefault(); show(idx); });
    });
    prevBtn.addEventListener('click', () => show(current - 1));
    nextBtn.addEventListener('click', () => show(current + 1));

    modalEl.addEventListener('shown.bs.modal', () => { document.addEventListener('keydown', onKey); });
    modalEl.addEventListener('hidden.bs.modal', () => { document.removeEventListener('keydown', onKey); });
    function onKey(e){
      if (e.key === 'ArrowLeft') show(current - 1);
      if (e.key === 'ArrowRight') show(current + 1);
    }
  })();
</script>
{% endblock %}

